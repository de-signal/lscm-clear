"use strict";angular.module("clearApp",["chieffancypants.loadingBar","http-auth-interceptor","ngRoute","ngAnimate","ngCookies","clearApp.filters","clearApp.services","clearApp.directives","clearApp.controllers","ui.bootstrap","angularFileUpload","nvd3ChartDirectives","toaster","clearApp.mock","clearApp.mockvalues"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){b.html5Mode(!0),b.hashPrefix("!"),c.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.when("/bug",{templateUrl:"partials/bugs.html",controller:"BugsCtrl"}),a.when("/static",{templateUrl:"partials/static.html"}),a.when("/guidelines",{templateUrl:"partials/guidelines-list.html",controller:"GuidelinesListCtrl"}),a.when("/guidelines/process",{templateUrl:"partials/guidelines-process.html",controller:"GuidelinesProcessCtrl"}),a.when("/guidelines/:id",{templateUrl:"partials/guidelines-operations.html",controller:"GuidelinesOperationsCtrl"}),a.when("/user",{templateUrl:"partials/user-detail.html",controller:"UserDetailCtrl"}),a.when("/dashboard",{templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",reloadOnSearch:!1}),a.when("/tv",{templateUrl:"partials/dashboard-tv.html",controller:"DashboardTvCtrl",reloadOnSearch:!1}),a.when("/tracking",{templateUrl:"partials/elements-tracking.html",controller:"ElementsTrackingCtrl",reloadOnSearch:!1}),a.when("/indicators",{templateUrl:"partials/indicators.html",controller:"IndicatorsCtrl"}),a.when("/search",{templateUrl:"partials/elements-search.html",controller:"ElementsSearchCtrl",reloadOnSearch:!1}),a.when("/documents/:type",{templateUrl:"partials/documents.html",controller:"DocumentsCtrl",reloadOnSearch:!1}),a.when("/documents/ir/:id",{templateUrl:"partials/documents-ir.html",controller:"DocumentsIrCtrl"}),a.when("/documents/ncr/:id",{templateUrl:"partials/documents-ncr.html",controller:"DocumentsNcrCtrl"}),a.when("/documents/pod/:id",{templateUrl:"partials/documents-pod.html",controller:"DocumentsPodCtrl"}),a.when("/stock/warehouses",{templateUrl:"partials/stock/warehouses.html",controller:"WarehousesCtrl"}),a.when("/stock/warehouses/:id",{templateUrl:"partials/stock/warehouse.html",controller:"WarehouseCtrl",reloadOnSearch:!1}),a.when("/stock/movements",{templateUrl:"partials/stock/movements.html",controller:"MovementsCtrl"}),a.when("/stock/replenishments",{templateUrl:"partials/stock/replenishments.html",controller:"ReplenishmentsCtrl"}),a.when("/stock/items",{templateUrl:"partials/stock/items.html",controller:"ItemsCtrl"}),a.when("/stock/items/:id",{templateUrl:"partials/stock/item.html",controller:"ItemCtrl"}),a.when("/stock/indicators",{templateUrl:"partials/stock/indicators.html",controller:"StockIndicatorsCtrl"}),a.when("/add-order",{templateUrl:"partials/elements-order-add.html",controller:"ElementsOrderAddCtrl"}),a.when("/alerts",{templateUrl:"partials/alerts.html",controller:"AlertsCtrl",reloadOnSearch:!1}),a.when("/:type/",{templateUrl:"partials/elements.html",controller:"ElementsCtrl",reloadOnSearch:!1}),a.when("/:type/:id",{templateUrl:"partials/element.html",controller:"ElementCtrl",reloadOnSearch:!1}),a.otherwise({redirectTo:"/dashboard"})}]),angular.module("clearApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]).filter("groupBy",function(){return function(a,b){if(a){for(var c,d=[],e=0;e<a.length;e++)c||(c=[]),c.push(a[e]),(e+1)%b==0&&(d.push(c),c=null);return c&&d.push(c),d}}}),angular.module("clearApp.services",["ngResource"]).factory("E1",["$resource",function(a){return a("../index_rest.php/api/clear/v1/:type/:id",{type:"@type",id:"@id"})}]).factory("S1",["$resource",function(a){return a("../index_rest.php/api/stock/v1/:type/:id",{type:"@type",id:"@id"},{update:{method:"PUT"},updateList:{method:"PUT",isArray:!0}})}]).factory("E2",["$resource",function(a){return a("../index_rest.php/api/clear/v2/:format/:type/:id/:action",{format:"@format",type:"@type",id:"@id",action:"@action"},{update:{method:"PUT"},updateList:{method:"PUT",isArray:!0}})}]).factory("Utils",function(){return{dateToTimestamp:function(a){return a instanceof Date?Math.floor(a.getTime()/1e3):null},timestampToDate:function(a){return new Date(1e3*a)},isEmpty:function(a){var b=Object.prototype.hasOwnProperty;if(null==a)return!0;if(a.length&&a.length>0)return!1;if(0===a.length)return!0;for(var c in a)if(b.call(a,c))return!1;return!0},collect:function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},clone:function(a){var b=this;if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var c=new Date;return c.setTime(a.getTime()),c}if(a instanceof Array){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b.clone(a[d]);return c}if(a instanceof Object){var c={};for(var f in a)a.hasOwnProperty(f)&&(c[f]=b.clone(a[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},objectByKey:function(a,b,c){for(var d in a)if(a[d][b]==c)return a[d]},objectIndexbyKey:function(a,b,c){for(var d in a)if(a[d][b]===c)return d;return-1}}}).factory("ClearList",["$filter","$rootScope","$q","toaster","Utils","ClearToken","E1","E2","S1","ElmsOrder","FiltersOrder","ElmsShipment","FiltersShipment","ElmsBox","FiltersBox","ElmsItem","FiltersItem","IRs","FiltersIRs","PODs","FiltersPODs","NCRs","FiltersNCRs","Archives","FiltersArchives","Medias","FiltersMedias","Alerts","FiltersAlerts","Items","FiltersItems","Movements","FiltersMovements","Replenishments","FiltersReplenishments",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){return{listElementsLoad:function(a){var b={1:g,2:h,3:i,6:B,10:j,11:l,12:n,13:p,20:r,21:t,22:v,23:x,24:z,30:F,31:H,32:D},d=a,k=c.defer(),m={type:a.type};return a.format&&(m.format=a.format),m=e.collect(m,a.urlParams),a.related&&(m.related=a.related,m.related_id=a.related_id),b[a.resource].query(m,function(b,c){d.pagination={itemsPerPage:a.urlInit.limit,page:a.urlParams.page,pagesCount:c("X-Clear-pagesCount"),elementsCount:c("X-Clear-elementsCount")},console.log("pagesCount: "+d.pagination.pagesCount+", elementsCount: "+d.pagination.elementsCount);for(var e in b)b[e].url&&(b[e].url=b[e].url+"?oauth_token="+f.returnToken()),b[e].url_thumb&&(b[e].url_thumb=b[e].url_thumb+"?oauth_token="+f.returnToken());d.elements=b,k.resolve(d)}),k.promise},listFiltersLoad:function(a){var b={1:g,2:h,3:i,6:C,10:k,11:m,12:o,13:q,20:s,21:u,22:w,23:y,24:A,30:G,31:I,32:E},d=this,e={},f=c.defer(),j={type:a.type,id:"filter"};return a.format&&(j.format=a.format),b[a.resource].get(j,function(b){if(b.users)for(var c in b.users)b.users[c].name=b.users[c].first_name+" "+b.users[c].last_name;e.values=b,e.badges=d.listFiltersBadgesInit(a.urlParams,a.filters,b),e.date=d.listFiltersDateInit(a.urlParams,a.filters),e.tmp=d.listFiltersTmpInit(a.urlParams,a.filters,b),f.resolve(e)}),f.promise},listFiltersDateInit:function(a,b){var c={},d=function(b){c[b]={},a[b]&&(c[b].value=e.timestampToDate(a[b]))};for(var f in b){var g=b[f];if("date"===g.type&&d(g.id),g.children)for(var h in g.children)"date"===g.children[h].type&&d(g.children[h].id)}return c},listFiltersTmpInit:function(a,b,c){var d={};if(d.property={},a.property_id){var f=c.properties;d.property=f[e.objectIndexbyKey(f,"id",a.property_id)],d.property.value}return d},listFiltersBadgesInit:function(b,c,d){var f=[],g=function(c){switch(c.type){case"date":return c.name+": "+a("date")(1e3*b[c.id],"dd.MM.yy");case"select":return c.name+": "+e.objectByKey(d[c.reference],"id",b[c.id]).name;case"selectProperty":var f=e.objectByKey(d.properties,"id",b.property_id),g=e.objectByKey(f.values,"id",b[c.id]);return console.log("propertySelected: ",f,"propertySelectedValue: ",g),c.name+": "+g.name;default:return c.name+": "+b[c.id]}};for(var h in c){var i=c[h];if(b.hasOwnProperty(i.id)){var j=g(i);if(i.children)for(var k in i.children)b.hasOwnProperty(i.children[k].id)&&(j+=", "+g(i.children[k]));f.push({id:i.id,content:j})}}return f},listCleanUrl:function(a){for(var b in a)a[b]&&null!==a[b]||delete a[b]},listBadgeRemove:function(a,b,c){var d=e.objectByKey(c,"id",a);if(b.hasOwnProperty(a)){if(d.children)for(var f in d.children)delete b[d.children[f].id];delete b[d.id]}},listPropertySave:function(a,b,c,f,g){var i=[],j={type:a.type,action:"updateList",format:a.format,ids:b.join(),propertyUpdateId:c.id,propertyUpdateVal:c.value};console.log("parameters: ",j);for(var k in b)i.push(e.objectByKey(a.elements,"id",b[k]));f&&(j=e.collect(j,g)),h.updateList(j,i,function(b,c){var e,f=a.elements.length+" "+a.type;c("X-Clear-updatedElements")&&(f="on "+c("X-Clear-updatedElements")),"success"===c("X-Clear-updatedProperty")?e="Properties updated"+f:"warning"===c("X-Clear-updatedProperty")?e="Property did not update"+f:"error"===c("X-Clear-updatedProperty")&&(e="Property did not update"+f),c("X-Clear-updatedProperty")&&d.pop(c("X-Clear-updatedProperty"),e,property.name)})}}}]).factory("ClearToken",function(){var a;return{updateToken:function(b){a=b},returnToken:function(){return a}}}).factory("ClearUrl",["$rootScope","$location","Utils",function(a,b,c){var d=[];return{listReady:function(b,c){var e=function(b){b.id&&b.conf&&a.$broadcast("event:listReady_"+b.id,b.conf)};if("init"===b){d=[];for(var f in c)d[c[f]]={}}else"conf"===b?(d[c.id].conf=c,e(d[c.id])):"id"===b&&(d[c.id].id=c.id,e(d[c.id]))},listsUrlSet:function(a,d){var e=b.search();if(d.listCode){var f={};for(var g in e){var h=g.slice(1,2);if(h===d.listCode){var i=g.slice(3,g.length);f[i]=e[g],delete e[g]}}c.isEmpty(a)&&(a=f),a=c.collect(d.urlInit,a);for(g in a)e["_"+d.listCode+"_"+g]=a[g];b.search(e)}else c.isEmpty(a)&&(a=e),a=c.collect(d.urlInit,a),b.search(a);return b.replace(),d.urlParams=a,d},go:function(c,d,e){a.tvScreen=!1,b.$$search={},b.path(c+"/"+d),e&&b.search("related_type_active",e).hash("related")}}}]).factory("ClearElement",["$rootScope","$modal","ClearToken","toaster","Utils",function(a,b,c,d,e){return{elementUpdate:function(a){var b=this;b.propertiesDate(a),b.elementUpdateUrl(a),b.qrCodeGoogle(a),b.elementTimeline(a);for(var c in a.charts)b.colorScaleConfig(a.charts[c],a.charts[c].value);return a},elementTimeline:function(a){if(!a.anim&&a.timeline)for(var b=0;4>b;b++)a.timeline[b].completed&&(a.timeline[b].anim=!0);return a},elementUpdateUrl:function(a){if(a.documents)for(var b in a.documents)a.documents[b].url=a.documents[b].url+"?oauth_token="+c.returnToken();return a},modalDelete:function(a,c){c.stopPropagation&&c.stopPropagation();var d=b.open({templateUrl:"partials/element-modal-delete.html",controller:"ElementModalDeleteCtrl",resolve:{elm:function(){return a}}});d.result.then(function(){},function(){})},modalCondition:function(a,c,d){if(d.stopPropagation&&d.stopPropagation(),c.editable||!c.completed){var e=b.open({templateUrl:"partials/element-modal-condition.html",controller:"ElementModalConditionCtrl",resolve:{condition:function(){return c},elm:function(){return a}}});e.result.then(function(){},function(){})}},modalAlert:function(a,c,d){var e=b.open({templateUrl:"partials/element-modal-alert.html",controller:"ElementModalAlertCtrl",resolve:{elm:function(){return a},alert:function(){return c},user:function(){return d}}});e.result.then(function(){},function(){})},modalAlertDelete:function(a,c){var d=b.open({templateUrl:"partials/element-modal-alert-delete.html",controller:"ElementModalAlertDeleteCtrl",resolve:{elm:function(){return a},alert:function(){return c}}});d.result.then(function(){},function(){})},modalDocumentUpload:function(a,c){var d=b.open({templateUrl:"partials/element-modal-document-upload.html",controller:"ElementModalDocumentUploadCtrl",resolve:{elm:function(){return a},user:function(){return c}}});d.result.then(function(){},function(){})},documentUploadSave:function(a,b,c){var f=this;a.user={first_name:c.first_name,last_name:c.last_name,id:c.id},a.dates={created:e.dateToTimestamp(new Date)},b.documents.push(a),console.log("elm: ",b),b.$update({documentUpload:a.id},function(b,c){var e;"success"===c("X-Clear-updatedDocument")?e="Updated document":"warning"===c("X-Clear-updatedDocument")?e="Document did not update":"error"===c("X-Clear-updatedDocument")&&(e="Document did not update"),c("X-Clear-updatedDocument")&&d.pop(c("X-Clear-updatedDocument"),e,a.name),console.log("success"),b=f.elementUpdate(b)},function(){console.log("error"),d.pop("error","Nothing updated")})},trackingToggle:function(a,b){b.stopPropagation&&b.stopPropagation(),a.tracking=!a.tracking},alertSave:function(a,b,c){var f=this;b.user={first_name:c.first_name,name:c.name,id:c.id},b.dates||(b.dates=[]),b.dates.modified=e.dateToTimestamp(new Date),b.id?a.alerts[e.objectIndexbyKey(a.alerts,"id",b.id)]=b:(a.alerts?a.alerts[a.alerts.length]=b:(a.alerts=[],a.alerts[0]=b),b.id="new"),a.$update({alertUpdateId:b.id},function(a,c){var e;"success"===c("X-Clear-updatedAlert")?e="Alert updated":"warning"===c("X-Clear-updatedAlert")?e="Alert did not update":"error"===c("X-Clear-updatedAlert")&&(e="Alert did not update"),c("X-Clear-updatedAlert")&&d.pop(c("X-Clear-updatedAlert"),e,b.name),a=f.elementUpdate(a)})},alertDelete:function(a,b){var c=this;a.$update({alertDeleteId:b.id},function(a,e){var f;"success"===e("X-Clear-updatedAlert")?f="Deleted alert":"warning"===e("X-Clear-updatedAlert")?f="Alert did not deleted":"error"===e("X-Clear-updatedAlert")&&(f="Alert did not deleted"),e("X-Clear-updatedAlert")&&d.pop(e("X-Clear-updatedAlert"),f,b.name),a=c.elementUpdate(a)})},propertySave:function(b,c,e){var f=this;a.currentGroup=e,b.$update({propertyUpdateId:c.id,propertyUpdateVal:c.value},function(a,b){var e;"success"===b("X-Clear-updatedProperty")?e="Property updated":"warning"===b("X-Clear-updatedProperty")?e="Property did not update":"error"===b("X-Clear-updatedProperty")&&(e="Property did not update"),b("X-Clear-updatedProperty")&&d.pop(b("X-Clear-updatedProperty"),e,c.name),a=f.elementUpdate(a)})},conditionSave:function(a,b){var c=this;a.$update({requiredId:b.id,requiredValue:b.value},function(a,e){var f,g;"success"===e("X-Clear-updatedRequired")?f="Condition updated":"warning"===e("X-Clear-updatedRequired")?f="Condition did not update":"error"===e("X-Clear-updatedRequired")&&(f="Condition did not update"),"success"===e("X-Clear-updatedMilestone")?g="Milestone updated":"warning"===e("X-Clear-updatedMilestone")?g="Milestone did not update":"error"===e("X-Clear-updatedMilestone")&&(g="Milestone did not update"),e("X-Clear-updatedRequired")&&d.pop(e("X-Clear-updatedRequired"),f,b.name),e("X-Clear-updatedMilestone")&&d.pop(e("X-Clear-updatedMilestone"),g,e("X-Clear-updatedMilestoneName")),console.log("success"),a=c.elementUpdate(a)},function(a){console.log("error: ",a)})},propertiesDate:function(a){for(var b in a.properties)for(var c in a.properties[b].set){var c=a.properties[b].set[c];"date"===c.type&&c.value&&(c.date=e.timestampToDate(c.value))}return a},qrCodeGoogle:function(a){var b;switch(a.type){case"order":b="O";break;case"shipment":b="S";break;case"box":b="B";break;case"item":b="I"}return a.qrCodeGoogle="http://chart.apis.google.com/chart?cht=qr&chs=63x63&chl="+b+a.id+"&chld=H%7C0",a},colorScaleConfig:function(a,b){var c="#5cb85c",d="#a6b15b",e="#eeac57",f="#e28054",g="#d75452",h=function(a){var b=null,c=[0,20,40,60,80,101],d=0;for(c.length;d<c.length;d++)if(c[d]>a){b=d-1;break}return b},i=function(a){var b=[g,f,e,d,c];return{color:b[h(a)]}},j=function(a){var b=["worst","bad","medium","good","best"];return b[h(a)]};return a.color=i(b),a.label=j(b),a}}}]).factory("ClearAlert",["$rootScope","$modal","Utils","toaster",function(a,b,c,d){return{alertModalEdit:function(a,c,d){var e=b.open({templateUrl:"partials/alerts-modal-edit.html",controller:"AlertModalEditCtrl",resolve:{alerts:function(){return a},alert:function(){return c},user:function(){return d}}});e.result.then(function(){},function(){})},alertModalDelete:function(a,c){var d=b.open({templateUrl:"partials/alerts-modal-delete.html",controller:"AlertModalDeleteCtrl",resolve:{alerts:function(){return a},alert:function(){return c}}});d.result.then(function(){},function(){})},alertSave:function(a,b){a.user={first_name:b.first_name,last_name:b.name,id:b.id},a.dates.modified=c.dateToTimestamp(new Date),a.$update({type:"alert"},function(b,c){var e;"success"===c("X-Clear-updatedAlert")?e="Alert update":"warning"===c("X-Clear-updatedAlert")?e="Alert did not update":"error"===c("X-Clear-updatedAlert")&&(e="Alert did not update"),c("X-Clear-updatedAlert")&&d.pop(c("X-Clear-updatedAlert"),e,a.name)})},alertDelete:function(a,b){a.$delete({type:"alert"},function(e,f){var g,h=f("X-Clear-updatedAlert");"success"===h?g="Deleted alert":"warning"===h?g="Alert did not deleted":"error"===h&&(g="Alert did not deleted"),h&&d.pop(h,g,a.name),e.id||b.splice(c.objectIndexbyKey(b,"id",a.id),1)})}}}]).factory("ClearDocument",["$rootScope","$modal","Utils","ClearUrl","toaster",function(a,b,c,d,e){return{documentModalUpload:function(a,c){var d=b.open({templateUrl:"partials/documents-modal-upload.html",controller:"DocumentModalUploadCtrl",resolve:{type:function(){return a},user:function(){return c}}});d.result.then(function(){},function(){})},documentUploadSave:function(b,d,f){b.user={first_name:f.first_name,last_name:f.last_name,id:f.id},b.dates={created:c.dateToTimestamp(new Date)},b.$save({format:"documents",type:"media",id:"new"},function(b,c){var d;"success"===c("X-Clear-updatedDocument")?d="Document uploaded":"warning"===c("X-Clear-updatedDocument")?d="Document did not upload":"error"===c("X-Clear-updatedDocument")&&(d="Document did not upload"),c("X-Clear-updatedDocument")&&e.pop(c("X-Clear-updatedDocument"),d,b.name),console.log("success"),a.$broadcast("event:urlSet",{},"documents")},function(){console.log("error"),e.pop("error","Nothing uploaded")})}}}]).factory("ChartsConfig",function(){var a=["#FFCC0F","#C79F25","#705A11","#9C863D","#BCAD74","#FFE699"],b=["#FF7F00","#C96301","#703700","#9D6826","#BC9461","#FFBF81"],c=["#7EDF02","#65AD01","#366201","#688F25","#95B164","#BFEF81"],d=["#36BFE3","#3194A7","#1C554F","#4F8180","#82A9A8","#A0DFF0"],e=["#FF7D9F","#C66378","#6F373A","#9B6865","#BD9595","#FFBED0"];return{colors:{brand:function(){return function(b,c){return a[c]}},order:function(){return function(a,c){return b[c]}},shipment:function(){return function(a,b){return c[b]}},box:function(){return function(a,b){return d[b]}},item:function(){return function(a,b){return e[b]}}},tooltips:{pieChart:function(){return function(a,b){return"<p><strong>"+a+"</strong></p><p>"+b+"</p>"}},hBarChart:function(){return function(a,b,c){return"<p><strong>"+a+"</strong></p><p>"+c+"</p>"}},vBarChart:function(){return function(a,b,c){return"<p><strong>"+b+", "+a+"</strong></p><p>"+c+"</p>"}},lineChart:function(){return function(a,b,c){return"<p><strong>"+a+"</strong></p><p>"+c+"</p>"}}},chartFn:function(a){a.xFunction=function(){return function(a){return a.key}},a.yFunction=function(){return function(a){return a.value}},a.descriptionFunction=function(){return function(a){return a.key}}}}}).factory("IRs",["$resource",function(a){return a("json/documents_irs.json")}]).factory("FiltersIRs",["$resource",function(a){return a("json/documents_irs_filters.json")}]).factory("IR",["$resource",function(a){return a("json/documents_ir.json")}]).factory("NCRs",["$resource",function(a){return a("json/documents_ncrs.json")}]).factory("FiltersNCRs",["$resource",function(a){return a("json/documents_ncrs_filters.json")}]).factory("Archives",["$resource",function(a){return a("json/documents_archives.json")}]).factory("FiltersArchives",["$resource",function(a){return a("json/documents_archives_filters.json")}]).factory("Medias",["$resource",function(a){return a("json/documents_medias.json")}]).factory("FiltersMedias",["$resource",function(a){return a("json/documents_medias_filters.json")}]).factory("Alert",["$resource",function(a){return a("json/alert.json")}]).factory("Alerts",["$resource",function(a){return a("json/alerts.json")}]).factory("FiltersAlerts",["$resource",function(a){return a("json/alerts_filters.json")}]).factory("NCR",["$resource",function(a){return a("json/documents_ncr.json")}]).factory("PODs",["$resource",function(a){return a("json/documents_pods.json")}]).factory("FiltersPODs",["$resource",function(a){return a("json/documents_pods_filters.json")}]).factory("POD",["$resource",function(a){return a("json/documents_pod.json")}]).factory("Indicators",["$resource",function(a){return a("json/indicators.json")}]).factory("StockIndicators",["$resource",function(a){return a("json/stock/indicators.json")}]).factory("Elms",["$resource",function(a){return a("json/elms.json")}]).factory("ElmsOrder",["$resource",function(a){return a("json/elms_order.json")}]).factory("ElmsShipment",["$resource",function(a){return a("json/elms_shipment.json")}]).factory("ElmsBox",["$resource",function(a){return a("json/elms_box.json")}]).factory("ElmsItem",["$resource",function(a){return a("json/elms_item.json")}]).factory("FiltersOrder",["$resource",function(a){return a("json/elms_order_filters.json")}]).factory("FiltersShipment",["$resource",function(a){return a("json/elms_shipment_filters.json")}]).factory("FiltersBox",["$resource",function(a){return a("json/elms_box_filters.json")}]).factory("FiltersItem",["$resource",function(a){return a("json/elms_item_filters.json")}]).factory("Bugs",["$resource",function(a){return a("json/bugs.json")}]).factory("ElmsConf",["$resource",function(a){return a("json/elms_conf.json")}]).factory("AlertsConfig",["$resource",function(a){return a("json/alerts_conf.json")}]).factory("DocumentsConfig",["$resource",function(a){return a("json/documents_conf.json")}]).factory("Elm",["$resource",function(a){return a("json/elm_shipment.json",{},{update:{method:"PUT"},updateList:{method:"PUT",isArray:!0}})}]).factory("ElmItem",["$resource",function(a){return a("json/elm_item.json",{},{update:{method:"PUT"},updateList:{method:"PUT",isArray:!0}})}]).factory("SearchFilters",["$resource",function(a){return a("json/filters.json")}]).factory("GuidelinesProcess",["$resource",function(a){return a("json/guidelines_process.json")}]).factory("GuidelinesWeb",["$resource",function(a){return a("json/guidelines_web.json")}]).factory("GuidelinesMobile",["$resource",function(a){return a("json/guidelines_mobile.json")}]).factory("News",["$resource",function(a){return a("json/news.json")}]).factory("Warehouse",["$resource",function(a){return a("json/stock/warehouse.json")}]).factory("Warehouses",["$resource",function(a){return a("json/stock/warehouses.json")}]).factory("ItemsConf",["$resource",function(a){return a("json/stock/items_conf.json")}]).factory("FiltersItems",["$resource",function(a){return a("json/stock/items_filters.json")}]).factory("Items",["$resource",function(a){return a("json/stock/items.json")}]).factory("Item",["$resource",function(a){return a("json/stock/item.json")}]).factory("MovementsConf",["$resource",function(a){return a("json/stock/movements_conf.json")}]).factory("Movements",["$resource",function(a){return a("json/stock/movements.json")}]).factory("FiltersMovements",["$resource",function(a){return a("json/stock/movements_filters.json")}]).factory("ReplenishmentsConf",["$resource",function(a){return a("json/stock/replenishments_conf.json")}]).factory("Replenishments",["$resource",function(a){return a("json/stock/replenishments.json")}]).factory("FiltersReplenishments",["$resource",function(a){return a("json/stock/replenishments_filters.json")}]).value("version","2.4"),angular.module("clearApp.controllers",[]).controller("UserCtrl",["$scope","$route","toaster","$cookieStore","$rootScope","authService","$http","E1","ClearToken",function(a,b,c,d,e,f,g,h,i){var j;e.section="logistic",console.log("uuuu"),d.get("token")&&(j=d.get("token"),i.updateToken(j.replace("OAuth ","")),g.defaults.headers.common.Authorization=j,a.loggedIn=!0,console.log("connect from cookie: ",g.defaults.headers.common),h.get({type:"user"},function(b){a.user=b})),a.login=function(){d.remove("token"),g.post("../oauth/oauth.php",{ignoreAuthModule:!0,login:a.username,password:a.password}).success(function(b){i.updateToken(b.access_token),j="OAuth "+b.access_token,a.remember&&d.put("token",j),g.defaults.headers.common.Authorization=j,console.log("connect from form: ",g.defaults.headers.common),h.get({type:"user"},function(b){var d=function(a){return a.headers.Authorization=j,a},e=b.first_name+" "+b.name;c.pop("success","Welcome",e),a.user=b,f.loginConfirmed(e,d)})}).error(function(a,b,d){c.pop("error","Error",d("X-clear-login"))})},a.logout=function(){g.post("../oauth/oauth.php",{action:"logout",token:j}).success(function(){d.remove("token"),delete g.defaults.headers.common.Authorization,b.reload(),console.log("logout: ",g.defaults.headers.common),c.pop("success","Logged out")}).error(function(a,b){console.log("status error :",b," / logout failed")})}}]).controller("UserDetailCtrl",["$scope","E1",function(a,b){b.get({type:"user"},function(b){a.user=b})}]).controller("ListCtrl",["$scope","Utils","ClearUrl","ClearElement","ClearList",function(a,b,c,d,e){var f={};a.listInit=function(b){a.loaded=!1,f.id=b,a.$on("event:listReady_"+f.id,function(b,c){f.conf=c,a.listQuery({})}),c.listReady("id",f)},a.listQuery=function(b){a.loaded=!1,e.listCleanUrl(b),c.listsUrlSet(b,f.conf),a.listLoad(f.conf)},a.listLoad=function(b){a.listElementsLoad(b),b.display.filters?a.listFiltersLoad(b):a.filters={}},a.listElementsLoad=function(b){e.listElementsLoad(b).then(function(c){a.list=c,("shipment"===b.type||"shipmentIn"===b.type||"shipmentOut"===b.type)&&(a.listShipment=!0),a.loaded=!0})},a.listFiltersLoad=function(b){e.listFiltersLoad(b).then(function(b){a.filters=b,a.filters.tmp.ModificationsOpen=!1,a.filters.tmp.ids=[],a.filters.tmp.propertyUpdate={}})},a.listSort=function(b){delete a.list.urlParams.page,a.list.urlParams.sortBy===b?a.list.urlParams.sortOrder="ASC"===a.list.urlParams.sortOrder?"DESC":"ASC":a.list.urlParams.sortBy=b,a.listQuery(a.list.urlParams,a.list.id)},a.propertySave=function(a,b,c){d.propertySave(a,b,c)},a.listPaginate=function(b){a.list.urlParams.page=b,a.listQuery(a.list.urlParams,a.list.id)},a.badgeRemove=function(b){e.listBadgeRemove(b,a.list.urlParams,a.list.filters),a.listQuery(a.list.urlParams,a.list.id)},a.calOpen=function(b,c){b.preventDefault(),b.stopPropagation(),a.filters.date[c].opened=!0},a.selectAll=function(){var b=a.list.elements;a.filters.tmp.ids=[];for(var c in b)isNaN(c)||a.filters.tmp.ids.push(b[c].id);a.list.pagination.pagesCount>1&&(a.filters.tmp.selectGlobalBtn=!0)},a.selectNone=function(){a.list.elements;a.filters.tmp.ids=[],a.selectGlobalOff()},a.selectInverse=function(){var b=a.list.elements;for(var c in b)a.selectToggle(b[c].id);a.selectGlobalOff()},a.selectToggle=function(b){var c=a.filters.tmp.ids.indexOf(b);c>-1?a.filters.tmp.ids.splice(c,1):a.filters.tmp.ids.push(b),a.selectGlobalOff()},a.selectGlobalOn=function(){a.filters.tmp.selectGlobal=!0,a.filters.tmp.selectGlobalConfirm=!0,a.filters.tmp.selectGlobalBtn=!1},a.selectGlobalOff=function(){a.filters.tmp.selectGlobalBtn=!1,a.filters.tmp.selectGlobalConfirm=!1},a.listPropertySave=function(){e.listPropertySave(a.list,a.filters.tmp.ids,a.filters.tmp.propertyUpdate,a.filters.tmp.selectGlobal,a.list.urlParams),a.selectGlobalOff(),a.filters.tmp.ModificationsOpen=!1,a.filters.tmp.ids=[],a.filters.tmp.propertyUpdate={}},a.stopPropagation=function(a){a.stopPropagation&&a.stopPropagation()},a.dateToTimestamp=b.dateToTimestamp,a.modalCondition=d.modalCondition,a.trackingToggle=d.trackingToggle,a.go=c.go,a.loaded=!1,a.$on("event:ListInit",function(b,c){a.listInit(c)})}]).controller("DashboardCtrl",["$location","$scope","$timeout","$routeParams","E1","ClearUrl","Utils",function(a,b,c,d,e,f){f.listReady("init",["dashboard"]);var g={resource:"1",type:"dashboard",id:"dashboard",display:{filters:!1},urlInit:{sortBy:"status",sortOrder:"ASC",limit:12}};c(function(){b.$broadcast("event:ListInit",g.id),f.listReady("conf",g)}),e.query({type:"report"},function(a){b.reports=a})}]).controller("DashboardTvCtrl",["$interval","$rootScope","$routeParams","$scope","E1","E2","Alerts","DashboardElms","ClearUrl",function(a,b,c,d,e,f,g,h){if(d.loaded=!1,b.tvScreen=!0,c.static)var i=h,j={};else var i=e,j={type:"dashboard",sortBy:"status",sortOrder:"ASC",limit:12};var k=function(){i.query(j,function(b){d.list=[],a(function(){d.list.push(b.shift())},100,b.length),d.loaded=!0})},l=function(){if(d.list){var b=d.list.length;a(function(){d.list.shift()},50,b).then(k)}};k(),a(l,25e3);var m,n;if(d.alertCurrent=1,c.static)var o=g,p={};else var o=f,p={type:"alert",sortBy:"status",sortOrder:"ASC",limit:12,active:!0};var q=function(){o.query(p,function(a){m=a.length;for(var b=0;m>b;b++)a[b].index=b+1;d.alerts=a}),n=d.alertCurrent<m?d.alertCurrent+1:1,d.alertCurrent=0,a(function(){d.alertCurrent=n},3e3,1)};q(),a(q,9e3)}]).controller("ElementsOrderAddCtrl",["$timeout","$scope",function(a,b){b.buttonDisable=function(){a(function(){b.buttonDisabled=!0},10)}}]).controller("ElementCtrl",["$scope","$routeParams","$location","$interval","$timeout","$anchorScroll","$modal","E2","Utils","ClearUrl","ClearElement","ElmsConf","Elm","ElmItem",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){if(a.loaded=!1,a.relatedActiveTab={},a.modalCondition=k.modalCondition,a.modalDelete=k.modalDelete,a.trackingToggle=k.trackingToggle,a.propertySave=function(a,b,c){k.propertySave(a,b,c)},a.dateToTimestamp=i.dateToTimestamp,a.calOpen=function(b,c){b.preventDefault(),b.stopPropagation();var d=function(b){var c=a.elm.properties;for(var d in c)for(var e in c[d].set){var f=c[d].set[e];if(f.name===b)return f}};d(c).opened=!0,console.log("currentProp: ",d(c))},a.modalAlert=k.modalAlert,a.modalAlertDelete=k.modalAlertDelete,"static"===b.id&&"shipment"===b.type)var o=m,p={};else if("static"===b.id&&"item"===b.type)var o=n,p={};else var o=h,p={format:"elements",type:b.type,id:b.id};o.get(p,function(g){if(g.anim=!0,g=k.elementUpdate(g),a.elm=g,g.timeline){var h=function(a){g.timeline[a].completed&&(g.timeline[a].anim=!0)},m=0;d(function(){h(m++)},1e3,4)}if(c.search().related_type_active){for(var n in g.related)if(c.search().related_type_active===g.related[n].type){a.relatedActiveTab[c.search().related_type_active]=!0;break}e(function(){f()},1e3)}if(g.related){var o=[];for(var n in g.related)o.push(g.related[n].type);j.listReady("init",o);var p=[];l.get(function(a){for(var c in g.related){var d=g.related[c].type;switch(p[d]=i.clone(a),p[d].related=g.type,p[d].related_id=g.id,p[d].type=d,p[d].id=d,p[d].name=g.related[c].name,g.related[c].type){case"order":p[d].listCode="O";break;case"shipment":p[d].listCode="S";break;case"box":p[d].listCode="B";break;case"item":p[d].listCode="I"}if("static"===b.id)switch(g.related[c].type){case"order":p[d].resource="10";break;case"shipment":p[d].resource="11";break;case"box":p[d].resource="12";break;case"item":p[d].resource="13"}else p[d].resource="2";j.listReady("conf",p[d])}})}a.modalDocumentUpload=k.modalDocumentUpload,a.loaded=!0})}]).controller("ElementsTrackingCtrl",["$scope","$location","$routeParams","Utils","ClearUrl","ElmsConf",function(a,b,c,d,e,f){e.listReady("init",["order","shipment","box","item"]);var g=[{name:"Orders",type:"order",url:"O"},{name:"Shipments",type:"shipment",url:"S"},{name:"Boxes",type:"box",url:"B"},{name:"Items",type:"item",url:"I"}],h=[];f.get(function(a){for(var b in g){var f=g[b].type;if(h[f]=d.clone(a),h[f].id=f,h[f].type=f,h[f].name=g[b].name,h[f].listCode=g[b].url,c.static)switch(g[b].type){case"order":h[f].resource="10";break;case"shipment":h[f].resource="11";break;case"box":h[f].resource="12";break;case"item":h[f].resource="13"}else h[f].resource="2";e.listReady("conf",h[f])}})}]).controller("ElementsSearchCtrl",["$scope","$location","$timeout","ClearUrl","Utils","ElmsConf",function(a,b,c,d,e,f){c(function(){d.listReady("init",["searchResult"]),a.$broadcast("event:ListInit","searchResult")}),a.urlSet=function(b){var c={};c.type=b,c.name=g[e.objectIndexbyKey(g,"type",b)].name,f.get(function(f){c=e.clone(f),c.id="searchResult",c.resource="2",a.urlPage=d.listsUrlSet({type:b},c).urlParams,d.listReady("conf",c),a.listShow=!0
})};var g=[{name:"Orders",type:"order"},{name:"Shipments in",type:"shipmentIn"},{name:"Shipments out",type:"shipmentOut"},{name:"Boxes",type:"box"},{name:"Items",type:"item"}];a.types=g,b.search().type?a.urlSet(b.search().type):(a.urlPage={},a.listShow=!1)}]).controller("ElementsCtrl",["$scope","$routeParams","ClearUrl","Utils","ElmsConf",function(a,b,c,d,e){c.listReady("init",["elements"]);var f=b.type;switch(f){case"order":a.type="order",a.name="Orders";break;case"shipment":a.type="shipment",a.name="Shipments";break;case"shipmentIn":a.type="shipment",a.name="Shipments in";break;case"shipmentOut":a.type="shipment",a.name="Shipments out";break;case"box":a.type="box",a.name="Boxes";break;case"item":a.type="item",a.name="Items"}e.get(function(b){var e=d.clone(b);e.type=f,e.name=a.name,e.id="elements",e.resource="2",a.$broadcast("event:ListInit","elements"),c.listReady("conf",e)})}]).controller("ElementModalDocumentUploadCtrl",["$scope","$upload","ClearElement","E2","$modalInstance","elm","user",function(a,b,c,d,e,f,g){a.doc={},a.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d];a.upload=b.upload({url:"/index_rest.php/api/clear/v2/elements/"+f.type+"/"+f.id+"?documentUpload=file",file:e}).progress(function(b){a.progressShow=!0,a.progress=parseInt(100*b.loaded/b.total)}).success(function(b){a.doc.value="fileUpload",a.doc.id=b.id,console.log("upload success: ",b)}).error(function(a){console.log("upload error: ",a)})}},a.documentUploadSave=function(a){c.documentUploadSave(a,f,g)},a.documentUploadClose=function(){e.close()},a.documentUploadCancel=function(){e.dismiss("cancel")}}]).controller("ElementModalConditionCtrl",["$scope","$upload","ClearElement","ClearUrl","$modalInstance","condition","elm",function(a,b,c,d,e,f,g){switch(a.condition=f,a.elm=g,console.log("elm: ",g,"/ elm.name: ",g.name,"/ condition: ",f),f.type){case"upload":var h=[];a.updateMethod={};for(var i in g.documents)"upload"===g.documents[i].origin&&h.push(g.documents[i]);h.length>0?(a.updateMethod.chooser=!0,a.updateMethod.documents=h):a.updateMethod.type="upload",a.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d];a.upload=b.upload({url:"/index_rest.php/api/clear/v2/elements/"+g.type+"/"+g.id+"?condition="+f.id,file:e}).progress(function(b){a.progressShow=!0,a.progress=parseInt(100*b.loaded/b.total)}).success(function(b){a.condition.value="fileUpload",console.log(b)})}};break;case"checkbox":break;case"date":a.minDate=new Date,a.$watch("condition.dt",function(b){b&&(a.condition.value=Math.floor(b.getTime()/1e3)),console.log("condition date -> name: ",a.condition.name,"/ value: ",a.condition.value,"/ dt: ",b)});break;case"text":break;case"email":break;case"link":}a.conditionSave=function(a,b){c.conditionSave(a,b),console.log("condition: ",b,b.name)},a.conditionClose=function(){e.close()},a.conditionCancel=function(){e.dismiss("cancel")},a.go=d.go}]).controller("ElementModalDeleteCtrl",["$scope","$location","$modalInstance","elm",function(a,b,c,d){a.elm=d,a.deleteConfirm=function(a){a.$delete({type:a.type,id:a.id}),b.path("tracking")},a.deleteClose=function(){c.close()},a.deleteCancel=function(){c.dismiss("cancel")}}]).controller("ElementModalAlertCtrl",["$scope","$modalInstance","Utils","ClearElement","elm","alert","user",function(a,b,c,d,e,f,g){f.id&&(a.alert=c.clone(f)),a.statuses=["success","warning","error"],a.alertSave=function(a){d.alertSave(e,a,g)},a.modalClose=function(){b.close()},a.modalCancel=function(){b.dismiss("cancel")}}]).controller("ElementModalAlertDeleteCtrl",["$scope","$modalInstance","ClearElement","elm","alert",function(a,b,c,d,e){a.alert=e,a.alertDelete=function(a){c.alertDelete(d,a)},a.modalClose=function(){b.close()},a.modalCancel=function(){b.dismiss("cancel")}}]).controller("AlertsCtrl",["$scope","$routeParams","ClearUrl","ClearAlert","Utils","AlertsConfig","$modal",function(a,b,c,d,e,f){c.listReady("init",["alerts"]),f.get(function(d){var f=e.clone(d);f.resource=b.static?"6":"2",f.type="alert",f.id="alerts",a.page={name:"Alerts",type:"alert"},a.$broadcast("event:ListInit",f.id),c.listReady("conf",f)}),a.alertModalEdit=d.alertModalEdit,a.alertModalDelete=d.alertModalDelete}]).controller("AlertModalEditCtrl",["$scope","$modalInstance","ClearAlert","Utils","alerts","alert","user",function(a,b,c,d,e,f,g){a.alert=d.clone(f),a.statuses=["success","warning","error"],a.alertSave=function(a){for(var b in a)f[b]=a[b];c.alertSave(f,g)},a.modalClose=function(){b.close()},a.modalCancel=function(){b.dismiss("cancel")}}]).controller("AlertModalDeleteCtrl",["$scope","$modalInstance","ClearAlert","alerts","alert",function(a,b,c,d,e){a.alert=e,a.alertDelete=function(a){c.alertDelete(a,d)},a.modalClose=function(){b.close()},a.modalCancel=function(){b.dismiss("cancel")}}]).controller("DocumentsCtrl",["$scope","$routeParams","ClearUrl","ClearDocument","Utils","DocumentsConfig",function(a,b,c,d,e,f){c.listReady("init",["documents"]);var g=b.type;f.get(function(d){var f=e.clone(d);switch(f.id="documents",f.type=g,a.page={type:g},g){case"ir":a.page.name="Inspection reports";break;case"ncr":a.page.name="Non-conformity reports";break;case"pod":a.page.name="Proofs of delivery";break;case"archive":a.page.name="Archives";break;case"media":a.page.name="Medias"}if(b.static)switch(g){case"ir":f.resource="20";break;case"pod":f.resource="21";break;case"ncr":f.resource="22";break;case"archive":f.resource="23";break;case"media":f.resource="24"}else f.resource="2";a.$broadcast("event:ListInit",f.id),c.listReady("conf",f)}),a.documentModalUpload=d.documentModalUpload}]).controller("DocumentModalUploadCtrl",["$scope","$upload","ClearDocument","E2","$modalInstance","type","user",function(a,b,c,d,e,f,g){a.type=f,a.doc=new d({}),a.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d];a.upload=b.upload({url:"/index_rest.php/api/clear/v2/documents/"+f+"?documentUpload=file",file:e}).progress(function(b){a.progressShow=!0,a.progress=parseInt(100*b.loaded/b.total),console.log("upload progress: ",b)}).success(function(b){a.doc.value="documentUpload",a.doc.id=b.id,console.log("upload success: ",b)}).error(function(a){console.log("upload error: ",a)})}},a.documentUploadSave=function(a){c.documentUploadSave(a,f,g)},a.documentUploadClose=function(){e.close()},a.documentUploadCancel=function(){e.dismiss("cancel")}}]).controller("IndicatorsCtrl",["$scope","$routeParams","E1","Indicators","ChartsConfig",function(a,b,c,d,e){if(a.loaded=!1,a.charts=[],b.static)var f=d,g={};else var f=c,g={type:"kpi"};f.query(g,function(b){for(var c=0,d=b.length;d>c;++c)e.chartFn(b[c]),a.charts[b[c].id]=b[c];a.loaded=!0,console.log("charts: ",b)}),a.colors=e.colors,a.tooltips=e.tooltips}]).controller("DocumentsIrCtrl",["$scope","$filter","$routeParams","$modal","E2","IR","ClearToken",function(a,b,c,d,e,f,g){if(a.loaded=!1,"static"===c.id)var h=f,i={},j="img/",k="";else var h=e,i={format:"documents",type:"ir",id:c.id},j="/index_rest.php/api/clear/v1/file/",k="?oauth_token="+g.returnToken();h.get(i,function(c){for(var d in c.boxes){var e=c.boxes[d];for(var f in e.items){var g=e.items[f];g.image&&(g.image.urlResource=j+g.image.url+k,g.image.thumbResource=j+g.image.thumb+k)}e.itemsGroupBy4=b("groupBy")(e.items,4)}a.doc=c,a.loaded=!0}),a.open=function(b){var c=d.open({templateUrl:"partials/documents-ir-modal-img.html",controller:"DocumentIrModalImgCtrl",resolve:{item:function(){return b}}});c.result.then(function(b){a.selected=b},function(){})}}]).controller("DocumentIrModalImgCtrl",["$scope","$modalInstance","item",function(a,b,c){a.item=c,a.cancel=function(){b.dismiss("cancel")}}]).controller("DocumentNcrCtrl",["$scope","$routeParams","E2","NCR","$modal","ClearToken",function(a,b,c,d,e,f){if(a.loaded=!1,"static"===b.id)var g=d,h={},i="";else var g=c,h={format:"documents",type:"ncr",id:b.id},i="?oauth_token="+f.returnToken();g.get(h,function(b){b.element.image.url=b.element.image.url+i,a.doc=b,a.loaded=!0}),a.open=function(b,c,d){if("closed"!=b.status){var f=e.open({templateUrl:"partials/documents-ncr-modal-msg.html",controller:"DocumentNcrModalMsgCtrl",resolve:{doc:function(){return b},user:function(){return c},type:function(){return d}}});f.result.then(function(b){a.selected=b},function(){})}}}]).controller("DocumentNcrModalMsgCtrl",["$scope","$modalInstance","doc","user","type",function(a,b,c,d,e){a.comment={},a.title="open"==e?"Add a comment":"Close report",a.saveNcrMessage=function(){var f=new Date,g=Math.floor(f.getTime()/1e3),h=a.comment.message,i={first_name:d.first_name,last_name:d.last_name,id:d.id};c.comments.push({date:g,status:e,message:h,user:i}),c.$save({type:"ncr",id:c.id,update:e,format:"documents"},function(){}),b.close()},a.cancel=function(){b.dismiss("cancel")}}]).controller("DocumentsPodCtrl",["$scope","$routeParams","ClearToken","E2","POD",function(a,b,c,d,e){if(a.loaded=!1,"static"===b.id)var f=e,g={},h="";else var f=d,g={format:"documents",type:"pod",id:b.id},h="?oauth_token="+c.returnToken();f.get(g,function(b){b.signature.image.url=b.signature.image.url+h,a.doc=b,a.loaded=!0})}]).controller("GuidelinesListCtrl",["$scope","GuidelinesProcess","GuidelinesWeb","GuidelinesMobile",function(a,b,c,d){b.query(function(b){a.elmsProcess=b}),c.get(function(b){a.elmWeb=b}),d.get(function(b){a.elmMobile=b})}]).controller("GuidelinesProcessCtrl",["$scope","$location","$anchorScroll","$timeout","GuidelinesProcess",function(a,b,c,d,e){e.query(function(b){a.elms=b,d(function(){c()},500)}),a.scrollTo=function(a){b.hash(a),c()},a.types=["order","shipment","box","item"],a.display={downloads:!0,interactions:!0,updates:!0,updates_mobile:!0,processing:!0},a.location={na:!0,vendor:!0,tohub:!0,hub:!0,fromhub:!0,port:!0,toclient:!0,client:!0},a.filterFn=function(b){return a.location[b.location_id]?!0:!1}}]).controller("GuidelinesOperationsCtrl",["$scope","$location","$anchorScroll","$timeout","$routeParams","GuidelinesWeb","GuidelinesMobile",function(a,b,c,d,e,f,g){a.types=["order","shipment","box","item"];var h;"web"===e.id&&(h=f),"mobile"===e.id&&(h=g),h.get(function(b){a.elm=b,d(function(){c()},500)}),a.scrollTo=function(a){b.hash(a),c()}}]).controller("BugsCtrl",["$scope","Bugs",function(a,b){b.query(function(b){a.bugs=b})}]).controller("WarehousesCtrl",["$scope","$filter","$rootScope","$routeParams","ClearUrl","S1","Warehouses","Utils",function(a,b,c,d,e,f,g){c.section="stock",a.loaded=!1;var h="warehouse";a.type=h,a.name="Warehouses";var i=d.static?g:f,j=d.static?{}:{type:"warehouse"};i.query(j,function(b){a.warehouses=b,a.loaded=!0})}]).controller("MovementsCtrl",["$scope","$filter","$rootScope","$routeParams","ClearUrl","Utils","MovementsConf",function(a,b,c,d,e,f,g){c.section="stock",a.loaded=!1,e.listReady("init",["movements"]),g.get(function(b){var c=f.clone(b);c.type="movement",c.name="Movements",c.id="movements",c.resource=d.static?"30":"3",a.$broadcast("event:ListInit",c.id),e.listReady("conf",c)})}]).controller("ReplenishmentsCtrl",["$scope","$filter","$rootScope","$routeParams","ClearUrl","Utils","ReplenishmentsConf",function(a,b,c,d,e,f,g){c.section="stock",a.loaded=!1,e.listReady("init",["replenishments"]),g.get(function(b){var c=f.clone(b);c.type="replenishment",c.name="Replenishments",c.id="replenishments",c.resource=d.static?"31":"3",a.$broadcast("event:ListInit",c.id),e.listReady("conf",c)})}]).controller("ItemsCtrl",["$scope","$routeParams","$rootScope","ClearUrl","Utils","ItemsConf",function(a,b,c,d,e,f){c.section="stock",d.listReady("init",["items"]);b.type;a.type="item",a.name="Items",f.get(function(c){var f=e.clone(c);f.type=a.type,f.name=a.name,f.id="items",f.resource=b.static?"32":"3",a.$broadcast("event:ListInit",f.id),d.listReady("conf",f)})}]).controller("ItemCtrl",["$scope","$routeParams","$location","$interval","$timeout","$rootScope","$modal","S1","Utils","ClearUrl","ClearElement","ClearToken","ElmsConf","Item","ChartsConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(f.section="stock",a.loaded=!1,a.relatedActiveTab={},a.dateToTimestamp=i.dateToTimestamp,"static"===b.id)var p=n,q={},r="?test";else var p=h,q={type:"item",id:b.id},r="?oauth_token="+l.returnToken();p.get(q,function(b){b=k.elementUpdate(b),a.elm=b;for(var c in b.movements)b.movements[c].out&&(b.movements[c].out.image.url+=r,console.log("image: ",b.movements[c].out.image.url));if(b.related){var d=[];for(var c in b.related)d.push(b.related[c].type)}if(b.indicators){a.charts=[];for(var c in b.indicators)o.chartFn(b.indicators[c]),a.charts[b.indicators[c].id]=b.indicators[c];a.colors=o.colors,a.tooltips=o.tooltips,a.yAxisTickFormatFunction=function(){return function(a){return d3.format("d")(a)}},a.xAxisTickFormatFunction=function(){return function(a){return d3.time.format("%d.%m.%Y")(new Date(a))}}}a.propertySave=function(a,b,c){k.propertySave(a,b,c)},a.loaded=!0})}]).controller("WarehouseCtrl",["$scope","$routeParams","$location","$timeout","$anchorScroll","$modal","$q","$rootScope","S1","Utils","ClearUrl","ReplenishmentsConf","Warehouse","MovementsConf","ItemsConf",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(h.section="stock",a.loaded=!1,a.relatedActiveTab={},k.listReady("init",["replenishment","movement","item"]),a.dateToTimestamp=j.dateToTimestamp,"static"===b.id)var p=m,q={};else var p=i,q={type:"warehouse",id:b.id};p.get(q,function(c){a.warehouse=c;var d={item:o,replenishment:l,movement:n},e={item:"I",replenishment:"R",movement:"M"},f={item:"32",replenishment:"31",movement:"30"},g=[];for(var h in c.related)d[c.related[h].type].get(function(a){var d=a.type;g[d]=j.clone(a),g[d].related=c.type,g[d].related_id=c.id,g[d].type=d,g[d].id=d,g[d].name=c.related[h].name,g[d].listCode=e[d],g[d].resource="static"===b.id?f[d]:"3",k.listReady("conf",g[d])});a.loaded=!0})}]).controller("StockIndicatorsCtrl",["$scope","$routeParams","$rootScope","S1","StockIndicators","ChartsConfig",function(a,b,c,d,e,f){if(c.section="stock",a.loaded=!1,a.charts=[],b.static)var g=e,h={};else var g=d,h={type:"kpi"};g.query(h,function(b){for(var c=0,d=b.length;d>c;++c)f.chartFn(b[c]),a.charts[b[c].id]=b[c];a.loaded=!0,console.log("charts: ",b)}),a.colors=f.colors,a.tooltips=f.tooltips,a.yAxisTickFormatFunction=function(){return function(a){return d3.format("d")(a)}},a.xAxisTickFormatFunction=function(){return function(a){return d3.time.format("%d.%m.%Y")(new Date(a))}}}]),angular.module("clearApp.directives",[]).directive("clearAuth",["$http",function(){return{restrict:"A",link:function(a){a.$on("event:auth-loginRequired",function(){a.loggedIn=!1,console.log("interceptor loginRequired")}),a.$on("event:auth-loginConfirmed",function(){a.loggedIn=!0,console.log("interceptor loginConfirmed")})}}}]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]).directive("dateFormat",function(){return{require:"ngModel",link:function(a,b,c,d){d.$formatters.unshift(function(a){return a?new Date(a):""}),d.$parsers.push(function(a){return a instanceof Date?Math.floor(a.getTime()):""})}}}).directive("status",function(){return function(a,b,c){switch(c.status){case"processing":b.addClass("label-success");break;case"upcoming":b.addClass("label-warning");break;case"late":b.addClass("label-danger");break;case"none":b.addClass("hide")}}}).directive("conditionStatus",function(){return function(a,b){a.condition.completed&&b.addClass("label-success"),a.condition.editable||(b.removeClass("label-warning"),b.removeClass("label-danger"))}}).directive("conditionStatusBtn",function(){return function(a,b){a.condition.completed&&b.addClass("completed"),a.condition.editable||b.addClass("btn-off")}}).directive("stepIcon",function(){return function(a,b){switch(a.milestone.step){case"current":b.addClass("i-chevron-big-r");break;case"next":case"future":b.addClass("i-chevron-big-d"),b.addClass("ultralight");break;default:b.addClass("i-chevron-big-d"),b.addClass("light")}}}).directive("conditionIcon",function(){return function(a,b){switch(a.condition.type){case"upload":b.addClass("i-condition-upload");break;case"document":b.addClass("i-condition-document");break;case"checkbox":b.addClass("i-condition-checkbox");break;case"date":b.addClass("i-condition-date");break;case"text":b.addClass("i-condition-text");break;case"email":b.addClass("i-condition-email");break;case"link":b.addClass("i-condition-link");break;case"scan":b.addClass("i-condition-scan");break;case"imi":b.addClass("i-condition-imi")}}}).directive("clearWarehouseMap",function(){return{templateUrl:"partials/stock/warehouse-tpl-map.html",scope:{a:"=areas"},link:function(a,b){a.$watch("a",function(b){if(void 0!==b){console.log("a: ",a.a);var c={};for(var d in a.a)c[a.a[d].position]=a.a[d];a.areas=c,console.log("areas: ",c)}}),console.log("eleeem: ",b[0]),a.label={},a.mouseover=function(b){console.log("clicked: ",b);var c=window[b].getBoundingClientRect(),d=window.areas.getBoundingClientRect(),e=c.bottom-d.top,f=c.left-d.left;a.label={name:a.areas[b].name,type:a.areas[b].type,ratio:a.areas[b].ratio,quantity:a.areas[b].quantity,reference:a.areas[b].reference,visible:!0,top:e+"px",left:f+"px"},console.log("mabel: ",a.label)},a.mouseleave=function(b){a.label.visible=!1,console.log("unclicked: ",b)}}}}).directive("clearItemMap",function(){return{templateUrl:"partials/stock/item-tpl-map.html",scope:{m:"=movements"},link:function(a){a.$watch("m",function(b){if(void 0!==b){var c={},d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N"];for(var e in d)c[d[e]]={color:"#EBE8E7"};for(var e in a.m)if(c[a.m[e].zones.dest.position]=a.m[e].zones.dest,c[a.m[e].zones.dest.position].step=a.m[e].step,c[a.m[e].zones.dest.position].color=a.m[e].current?"#FFCB32":"#EBE8E7",a.m[e].zones.dest.rack&&a.m[e].current){var f=a.m[e].zones.dest.rack;a.rack=f;var g={A:["1","1"],B:["2","1"],C:["1","2"],D:["2","2"],E:["1","3"],F:["2","3"]};f.colors=[];for(var e in g)f.colors[e]=f.bin===g[e][0]&&f.high===g[e][1]?"#FFCB32":"#EBE8E7"}a.movements=c,console.log("movements: ",c)}})}}});